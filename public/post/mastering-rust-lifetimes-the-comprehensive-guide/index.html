<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://atharvapandey.com/css/frameworks.min.css as=style><link rel=stylesheet href=https://atharvapandey.com/css/frameworks.min.css media=print onload='this.media="all"'><noscript><link rel=stylesheet href=https://atharvapandey.com/css/frameworks.min.css></noscript><link rel=stylesheet href=https://atharvapandey.com/css/github.min.css><link rel=stylesheet href=https://atharvapandey.com/css/github-style.css><link rel=stylesheet href=https://atharvapandey.com/css/light.css><link rel=stylesheet href=https://atharvapandey.com/css/dark.css><link rel=stylesheet href=https://atharvapandey.com/css/syntax.css><link rel=stylesheet href=https://unpkg.com/applause-button/dist/applause-button.css><script defer src=https://unpkg.com/applause-button/dist/applause-button.js></script><title>Mastering Rust Lifetimes: The Comprehensive Guide - Atharva Pandey</title>
<link rel=icon type=image/x-icon href=/images/nerd-crab.ico><meta name=theme-color content="#1e2327"><script defer src=https://atharvapandey.com/js/theme-mode.js></script><meta name=description content="Dive into Atharva Pandey's tech blog for expert insights on software development, architecture, and cutting-edge technologies like Rust, Go, JavaScript, Blockchain, and AI. Decaf is BS, and so are half-baked tech articles."><meta name=keywords content="Atharva Pandey,tech blog,software development,programming,Rust,Go,JavaScript,React,TypeScript,software architecture,blockchain,AI,distributed systems,computer science"><link rel=canonical href=https://atharvapandey.com/post/mastering-rust-lifetimes-the-comprehensive-guide/><meta name=robots content="index, follow"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="https://atharvapandey.com/"><meta name=twitter:creator content="Atharva Pandey"><meta name=twitter:title content="Mastering Rust Lifetimes: The Comprehensive Guide - Atharva Pandey"><meta name=twitter:description content="Mastering Rust Lifetimes: The Comprehensive Guide
Understanding lifetimes in Rust is crucial for any Rustacean aiming to write safe and efficient code. Lifetimes are Rust&amp;rsquo;s unique approach to managing memory without a garbage collector, ensuring memory safety and eliminating data races. This guide will take you from the basics to more nuanced aspects of lifetimes, with plenty of examples to solidify your understanding.
Part 1: The Foundations of Lifetimes What Are Lifetimes?"><meta name=twitter:image content="https://atharvapandey.com/"><meta property="og:type" content="article"><meta property="og:title" content="Mastering Rust Lifetimes: The Comprehensive Guide - Atharva Pandey"><meta property="og:description" content="Mastering Rust Lifetimes: The Comprehensive Guide
Understanding lifetimes in Rust is crucial for any Rustacean aiming to write safe and efficient code. Lifetimes are Rust&amp;rsquo;s unique approach to managing memory without a garbage collector, ensuring memory safety and eliminating data races. This guide will take you from the basics to more nuanced aspects of lifetimes, with plenty of examples to solidify your understanding.
Part 1: The Foundations of Lifetimes What Are Lifetimes?"><meta property="og:url" content="https://atharvapandey.com/post/mastering-rust-lifetimes-the-comprehensive-guide/"><meta property="og:site_name" content="Atharva Pandey"><meta property="og:image" content="https://atharvapandey.com/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2024-02-23 18:30:00 +0000 UTC"><link rel=dns-prefetch href=https://www.googletagmanager.com><link href=https://www.googletagmanager.com rel=preconnect crossorigin></head><body><div style=position:relative><header class="flex-wrap px-3 Header js-details-container Details px-md-4 px-lg-5 flex-md-nowrap open Details--on"><div class="Header-item mobile-none" style=margin-top:-4px;margin-bottom:-4px><a class=Header-link href=https://atharvapandey.com/ aria-label=Homepage><img class=octicon height=32 width=32 alt=Logo src=/images/nerdy-crab-light.webp></a></div><div class="Header-item d-md-none"><button class="Header-link btn-link js-details-target" type=button aria-expanded=false aria-controls=header-search>
<img height=24 class="octicon octicon-three-bars" width=24 alt=Menu src=/images/nerdy-crab-light.webp></button></div><div style=display:none id=header-search class="mt-3 mr-0 Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-md-3 mt-md-0 Details-content--hidden-not-important d-md-flex"><div class="flex-auto mb-3 mr-0 Header-search header-search js-site-search position-relative flex-self-stretch flex-md-self-auto mb-md-0 mr-md-3 scoped-search site-scoped-search js-jump-to"><div class=position-relative><form target=_blank action=https://www.google.com/search accept-charset=UTF-8 method=get autocomplete=off role=search><label class="p-0 Header-search-label form-control input-sm header-search-wrapper js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center"><input type=search class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable" name=q placeholder=Search autocomplete=off aria-label=Search>
<input type=hidden name=as_sitesearch value=https://atharvapandey.com/></label></form></div></div></div><div class="Header-item Header-item--full flex-justify-center d-md-none position-relative"><a class=Header-link href=https://atharvapandey.com/ aria-label=Homepage><img class="octicon octicon-mark-github v-align-middle" height=32 width=32 alt=Logo src=/images/nerdy-crab-light.webp></a></div><div class=Header-item style=margin-right:0><button class="border-none Header-link no-select" onclick=switchTheme() aria-label="Switch Theme"><svg style="fill:var(--color-profile-color-modes-toggle-moon)" class="no-select" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.52208 7.71754c3.05612.0 5.53362-2.47748 5.53362-5.5336C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961 9.95801 1.07727 10.3495.771159 10.6474.99992c1.4679 1.12724 2.4141 2.90007 2.4141 4.89391.0 3.40575-2.7609 6.16667-6.16665 6.16667-2.94151.0-5.40199-2.0595-6.018122-4.81523C.794841 6.87902 1.23668 6.65289 1.55321 6.85451 2.41106 7.40095 3.4296 7.71754 4.52208 7.71754z"/></svg></button></div></header></div><div><main><div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4"><div class=px-0><div class="mb-3 d-flex px-3 px-md-3 px-lg-5"><div class="flex-auto min-width-0 width-fit mr-3"><div class=d-flex><div class="d-none d-md-block"><a class="avatar mr-2 flex-shrink-0" href=https://atharvapandey.com/><img class=avatar-user src=/images/avatar.webp width=32 height=32></a></div><div class="d-flex flex-column"><h1 class="break-word f3 text-normal mb-md-0 mb-1"><span class=author><a href=https://atharvapandey.com/>Atharva Pandey</a></span><span class=path-divider>/</span><strong class="css-truncate-target mr-1" style=max-width:410px><a href=https://atharvapandey.com/post/mastering-rust-lifetimes-the-comprehensive-guide/>Mastering Rust Lifetimes: The Comprehensive Guide</a></strong></h1><div class="note m-0">Created <relative-time datetime="Fri, 23 Feb 2024 18:30:00 +0000" class=no-wrap>Fri, 23 Feb 2024 18:30:00 +0000</relative-time>
<span class=file-info-divider></span>
Modified <relative-time datetime="Fri, 23 Feb 2024 18:30:00 +0000" class=no-wrap>Fri, 23 Feb 2024 18:30:00 +0000</relative-time></div></div></div></div></div></div></div><div class="container-lg px-3 new-discussion-timeline"><div class="repository-content gist-content"><div><div class="js-gist-file-update-container js-task-list-container file-box"><div id=file-pytest class="file my-2"><div id=post-header class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style=z-index:2><div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0"><summary id=toc-toggle onclick=clickToc() class="btn btn-octicon m-0 mr-2 p-2"><svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered"><path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zM3 8A1 1 0 111 8a1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"/></svg></summary><details-menu class=SelectMenu id=toc-details style="display: none;"><div class="SelectMenu-modal rounded-3 mt-1" style=max-height:340px><div class="SelectMenu-list SelectMenu-list--borderless p-2" style=overscroll-behavior:contain id=toc-list></div></div></details-menu>1624 Words</div><div class="file-actions flex-order-2 pt-0"></div></div></div><div class="Box-body px-5 pb-5" style=z-index:1><article class="markdown-body entry-content container-lg"><h1 id=imagesrust-lifetimewebp>Mastering Rust Lifetimes: The Comprehensive Guide<br><img src=/images/rust-lifetime.webp alt></h1><p>Understanding lifetimes in Rust is crucial for any Rustacean aiming to write safe and efficient code. Lifetimes are Rust&rsquo;s unique approach to managing memory without a garbage collector, ensuring memory safety and eliminating data races. This guide will take you from the basics to more nuanced aspects of lifetimes, with plenty of examples to solidify your understanding.</p><h2 id=part-1-the-foundations-of-lifetimes>Part 1: The Foundations of Lifetimes</h2><h3 id=what-are-lifetimes>What Are Lifetimes?</h3><p>In Rust, every reference has a lifetime, which is the scope for which that reference is valid. Lifetimes ensure that references do not outlive the data they refer to, preventing dangling references and ensuring data race freedom.</p><p>Imagine variables in Rust as tenants in an apartment building. The building represents memory, and each apartment is a piece of data. A reference is like a key to an apartment. Lifetimes are the lease agreements that dictate how long a tenant (variable) can hold onto a key (reference) before it must be returned, ensuring no one tries to enter an apartment (access memory) that&rsquo;s no longer theirs.</p><h4 id=the-syntax-of-lifetimes>The Syntax of Lifetimes</h4><p>Lifetime annotations in Rust are denoted by an apostrophe (&rsquo;) followed by a name, like &lsquo;a. These annotations are used to connect the lifetimes of various parameters and return values in functions.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>borrow_checker</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span>(item: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    item
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this function, &lsquo;a is a lifetime parameter that says: &ldquo;The returned reference lives as long as the input reference.&rdquo;</p><h4 id=why-lifetimes-are-necessary>Why Lifetimes Are Necessary</h4><p>Lifetimes prevent &ldquo;use after free&rdquo; errors, which occur when a reference tries to access data that has been freed. They are a compile-time feature, meaning Rust&rsquo;s borrow checker analyzes lifetime annotations to ensure safety before the program runs.</p><h2 id=part-2-diving-deeper-into-lifetimes>Part 2: Diving Deeper into Lifetimes</h2><h3 id=the-borrow-checker-rusts-lifeguard>The Borrow Checker: Rust&rsquo;s Lifeguard</h3><p>The borrow checker is the component of the Rust compiler responsible for enforcing rules that ensure memory safety. It examines how references are used in the code to ensure that any data referenced is alive. Think of the borrow checker as a lifeguard, diligently watching to ensure everyone swims safely within the designated areas.</p><h3 id=lifetime-annotations-in-functions>Lifetime Annotations in Functions</h3><p>When defining functions that accept and/or return references, you might need to annotate lifetimes to help the borrow checker understand the relationship between the inputs and outputs.</p><h4 id=example-the-longest-string-function>Example: The Longest String Function</h4><p>Consider a function that takes two string references and returns a reference to the longest string:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>longest</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span>(x: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>, y: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> x.len() <span style=color:#f92672>&gt;</span> y.len() { x } <span style=color:#66d9ef>else</span> { y }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This function declares a lifetime &lsquo;a and then uses it to annotate the lifetimes of both input references and the return reference. The annotation tells the compiler that the returned reference will be valid for as long as the shortest of x or y is.</p><h3 id=lifetime-annotations-in-structs>Lifetime Annotations in Structs</h3><p>When structs hold references, you must also annotate their lifetimes to ensure the data referenced by the struct lives as long as the struct itself.</p><h4 id=example-a-struct-holding-a-reference>Example: A Struct Holding a Reference</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Article</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    title: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>,
</span></span><span style=display:flex><span>    content: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> Article<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>summary</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&amp;</span>self.title
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=part-3-advanced-lifetime-scenarios>Part 3: Advanced Lifetime Scenarios</h2><h3 id=multiple-lifetime-parameters>Multiple Lifetime Parameters</h3><p>Functions and structs can have multiple lifetime parameters to handle more complex scenarios where different references have different lifetimes.</p><h4 id=example-mixing-references-with-different-lifetimes>Example: Mixing References with Different Lifetimes</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>mix</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span>, <span style=color:#a6e22e>&#39;b</span><span style=color:#f92672>&gt;</span>(x: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>, y: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;b</span> <span style=color:#66d9ef>str</span>) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;Second string: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, y);
</span></span><span style=display:flex><span>    x
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here, x and y have different lifetimes. The function&rsquo;s return type is tied to the lifetime of x, independent of y.</p><h3 id=lifetime-elision-rules>Lifetime Elision Rules</h3><p>In many cases, Rust allows you to omit explicit lifetime annotations through a set of deterministic rules known as &ldquo;lifetime elision rules.&rdquo; These rules allow Rust to infer lifetimes in functions, reducing the need for explicit annotations.</p><h4 id=elision-in-practice>Elision in Practice</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>first_word</span>(s: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>s[<span style=color:#f92672>..</span>s.find(<span style=color:#e6db74>&#39; &#39;</span>).unwrap_or_else(<span style=color:#f92672>||</span> s.len())]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><br>In this function, Rust infers the lifetimes based on the rules, understanding that the output reference&rsquo;s lifetime is tied to the input reference&rsquo;s lifetime.</p><h3 id=the-static-lifetime>The &lsquo;static Lifetime</h3><p>The &lsquo;static lifetime is a special lifetime that lasts for the entire duration of the program. It&rsquo;s commonly seen in string literals, which are stored directly in the program&rsquo;s binary and are therefore always available.\</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>let</span> motto: <span style=color:#66d9ef>&amp;</span>&#39;static <span style=color:#66d9ef>str</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;To infinity and beyond!&#34;</span>;
</span></span></code></pre></div><h3 id=lifetime-boundaries-and-traits>Lifetime Boundaries and Traits</h3><p>Lifetimes also interact with trait bounds. When implementing traits for types holding references, you might need to specify lifetime parameters to ensure the trait methods do not outlive the data they reference.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>trait</span> Description {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>describe</span>(<span style=color:#f92672>&amp;</span>self) -&gt; String;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> Description <span style=color:#66d9ef>for</span> Article<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>describe</span>(<span style=color:#f92672>&amp;</span>self) -&gt; String {
</span></span><span style=display:flex><span>        format!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, self.title, self.content)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=part-4-practical-tips-and-tricks>Part 4: Practical Tips and Tricks</h2><h3 id=understanding-compiler-errors>Understanding Compiler Errors</h3><p>Rust&rsquo;s compiler provides detailed error messages related to lifetimes. Learning to read these messages can significantly help in diagnosing and fixing lifetime-related issues.</p><h3 id=lifetime-annotations-are-not-always-required>Lifetime Annotations Are Not Always Required</h3><p>Remember, Rust&rsquo;s lifetime elision rules mean you won&rsquo;t always need to annotate lifetimes explicitly. Use them when necessary to clarify complex relationships to the compiler.</p><h3 id=testing-and-documentation>Testing and Documentation</h3><p>Testing functions and structures that use lifetimes is crucial. Ensure your tests cover various scenarios, especially edge cases that might challenge lifetime assumptions. Additionally, documenting how lifetimes are used in your code can greatly aid future maintenance and understanding.</p><h3 id=lifetimes-are-a-part-of-rusts-safety-guarantees>Lifetimes Are a Part of Rust&rsquo;s Safety Guarantees</h3><p>Embrace lifetimes as a feature that contributes to Rust&rsquo;s guarantees of memory safety and concurrency safety. Understanding and using lifetimes effectively allows you to leverage the full power of Rust.\</p><h2 id=understanding-lifetimes-with-irctc>Understanding Lifetimes with IRCTC</h2><p>In Rust, lifetimes are about ensuring that train (data) references don&rsquo;t outlive their journey (the scope in which they are valid). It&rsquo;s like making sure your train ticket is valid for your entire journey, from your departure station to your destination, without getting cancelled midway.</p><h3 id=basic-lifetime-example-booking-a-ticket>Basic Lifetime Example: Booking a Ticket</h3><p>Imagine booking a train ticket through IRCTC. Your ticket is only valid as long as the train journey itself. If the train journey represents a data scope in Rust, your ticket is akin to a reference.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Itinerary</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    journey: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> mumbai_to_chennai <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Mumbai to Chennai&#34;</span>; <span style=color:#75715e>// Your planned journey.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> trip <span style=color:#f92672>=</span> Itinerary {
</span></span><span style=display:flex><span>        journey: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>mumbai_to_chennai</span>,
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;Your itinerary includes: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, trip.journey); <span style=color:#75715e>// This works perfectly!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Here, Itinerary holds a reference to your journey. The &lsquo;a lifetime ensures the itinerary (struct) can&rsquo;t outlive the journey it refers to, much like how your travel itinerary is only valid as long as the journeys within it are.</p><h3 id=advanced-lifetime-scenarios-change-of-plans>Advanced Lifetime Scenarios: Change of Plans</h3><p>Imagine planning a trip with two train routes: the first from New Delhi to Agra, and the second from Agra to Jaipur. The catch is, you have some time to spend in Agra, maybe visiting the Taj Mahal, before catching your next train to Jaipur. This layover in Agra means the lifetime of your stay in Agra is independent of your journey from New Delhi to Agra and your subsequent journey to Jaipur.</p><p>Translating this to Rust, we&rsquo;d have a function that takes two references (our train journeys) with distinct lifetimes. The function might return a reference tied to the first journey (New Delhi to Agra), while the second journey (Agra to Jaipur) has a different, unrelated lifetime because of the layover.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>book_trains</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span>, <span style=color:#a6e22e>&#39;b</span><span style=color:#f92672>&gt;</span>(delhi_to_agra: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>, agra_to_jaipur: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;b</span> <span style=color:#66d9ef>str</span>) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;Layover plan: Visit </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, agra_to_jaipur);
</span></span><span style=display:flex><span>    delhi_to_agra <span style=color:#75715e>// Your ticket from New Delhi to Agra is returned.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> delhi_to_agra <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;New Delhi to Agra: 06:00 - 08:00&#34;</span>;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> agra_to_jaipur <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Agra to Jaipur: 12:00 - 14:00&#34;</span>; <span style=color:#75715e>// Notice the layover time in Agra.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> first_leg <span style=color:#f92672>=</span> book_trains(delhi_to_agra, agra_to_jaipur);
</span></span><span style=display:flex><span>        println!(<span style=color:#e6db74>&#34;First leg of the journey: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, first_leg);
</span></span><span style=display:flex><span>    } <span style=color:#75715e>// The Agra to Jaipur plan ends here, but it doesn&#39;t affect the New Delhi to Agra ticket.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>In this example, &lsquo;a and &lsquo;b represent the lifetimes of the two train journeys. The function book_trains returns a reference to the first journey (delhi_to_agra), tied to its lifetime &lsquo;a. The second journey (agra_to_jaipur) has its own distinct lifetime &lsquo;b, which allows for the layover in Agra. This demonstrates how different lifetimes can represent independent durations or scopes within a Rust program, akin to the distinct segments of your travel plan.</p><h3 id=lifetime-elision-the-smart-conductor>Lifetime Elision: The Smart Conductor</h3><p>In many cases, Rust&rsquo;s compiler (the smart conductor) can infer lifetimes without explicit annotations, thanks to lifetime elision rules. This is like a conductor who knows the journey details without checking every ticket.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>first_train</span>(s: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>s[<span style=color:#f92672>..</span>s.find(<span style=color:#e6db74>&#39; &#39;</span>).unwrap_or_else(<span style=color:#f92672>||</span> s.len())]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><br>In this function, Rust infers the lifetimes, understanding that the output&rsquo;s lifetime is tied to the input&rsquo;s, ensuring your ticket (reference) is valid for the entire journey (data scope).<br><br>Navigating Through Complications</p><h4 id=the-cancellation-scenario>The Cancellation Scenario</h4><p>Imagine one of your connecting trains gets cancelled, but your itinerary still references it.\</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> itinerary <span style=color:#f92672>=</span> Vec::new();
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> chennai_to_kolkata <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Chennai to Kolkata&#34;</span>;
</span></span><span style=display:flex><span>        itinerary.push(<span style=color:#f92672>&amp;</span>chennai_to_kolkata);
</span></span><span style=display:flex><span>    } <span style=color:#75715e>// &#39;chennai_to_kolkata&#39; journey ends (is cancelled).
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    println!(<span style=color:#e6db74>&#34;Itinerary: </span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>, itinerary); <span style=color:#75715e>// Error: borrowed value does not live long enough.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>This scenario demonstrates the importance of ensuring that references in a collection (like an itinerary) must remain valid for the collection&rsquo;s entire lifetime, akin to ensuring all train journeys in your itinerary are confirmed and not cancelled.\</p><h3 id=conclusion-rust-bye-message>Conclusion: Rust bye message</h3><p>Documenting your code, especially the parts involving lifetimes, is like sharing your travel stories. It helps others follow in your footsteps more easily, ensuring they can learn from your experiences. There are fair share of concept&rsquo;s that are not covered in this blog, I expect you refer to rustbook to complete those missing parts, this is just my attempt to simplify lifetimes for in rust for everyone.</p></article></div></div></div></div></div></div></main></div><script type=application/javascript src=https://atharvapandey.com/js/toc.js></script><link rel=stylesheet href=https://atharvapandey.com/css/toc.css><div class="px-3 container-lg new-discussion-timeline"><script defer src=https://giscus.app/client.js data-repo=gopherine/hugo-blog data-repo-id=R_kgDOLTrS1w data-category=Announcements data-category-id data-mapping=title data-strict=0 data-reactions-enabled data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div><applause-button style="width: 58px; height: 58px; position: fixed; bottom: 20px; left: 20px;"><div class="footer container-xl width-full p-responsive"><div class="flex-row-reverse flex-wrap pt-6 pb-2 mt-6 position-relative d-flex flex-lg-row flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center f6 text-gray border-top border-gray-light"><a aria-label=Homepage title=GitHub class="footer-octicon d-none d-lg-block mr-lg-4" href=https://atharvapandey.com/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="flex-wrap mb-2 list-style-none d-flex col-12 flex-justify-center flex-lg-justify-between mb-lg-0"><li class="mr-3 mr-lg-0">Copyright © 2024 Atharva Pandey</li></ul></div><div class="pb-6 d-flex flex-justify-center"><span class="f6 text-gray-light"></span></div></div></body><script defer type=application/javascript src=https://atharvapandey.com/js/github-style.js></script></html>