<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://atharvapandey.com/css/frameworks.min.css as=style><link rel=stylesheet href=https://atharvapandey.com/css/frameworks.min.css media=print onload='this.media="all"'><noscript><link rel=stylesheet href=https://atharvapandey.com/css/frameworks.min.css></noscript><link rel=stylesheet href=https://atharvapandey.com/css/github.min.css><link rel=stylesheet href=https://atharvapandey.com/css/github-style.css><link rel=stylesheet href=https://atharvapandey.com/css/light.css><link rel=stylesheet href=https://atharvapandey.com/css/dark.css><link rel=stylesheet href=https://atharvapandey.com/css/syntax.css><link rel=stylesheet href=https://unpkg.com/applause-button/dist/applause-button.css><script defer src=https://unpkg.com/applause-button/dist/applause-button.js></script><title>Traits: Advanced Trait Concepts and Dynamic Dispatch in Rust (Part 2) - Atharva Pandey</title>
<link rel=icon type=image/x-icon href=/images/favicon.ico><meta name=theme-color content="#1e2327"><script defer src=https://atharvapandey.com/js/theme-mode.js></script><meta name=description content="Dive into Atharva Pandey's tech blog for expert insights on software development, architecture, and cutting-edge technologies like Rust, Go, JavaScript, Blockchain, and AI. Decaf is BS, and so are half-baked tech articles."><meta name=keywords content="Atharva Pandey,tech blog,software development,programming,Rust,Go,JavaScript,React,TypeScript,software architecture,blockchain,AI,distributed systems,computer science"><link rel=canonical href=https://atharvapandey.com/post/rust/traits-part2-advance-trait-concepts/><meta name=robots content="index, follow"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="https://atharvapandey.com/"><meta name=twitter:creator content="Atharva Pandey"><meta name=twitter:title content="Traits: Advanced Trait Concepts and Dynamic Dispatch in Rust (Part 2) - Atharva Pandey"><meta name=twitter:description content="Trait Objects and Dynamic Dispatch In Rust, polymorphism achieved through traits can take two forms: static and dynamic dispatch. Static dispatch is like knowing exactly what tool you’re going to use for a job, making it fast and efficient. Dynamic dispatch, on the other hand, is more flexible, allowing you to choose the right tool while the job is already underway.
Understanding Trait Objects and dyn Keyword Trait objects with the dyn keyword allow for this kind of runtime flexibility."><meta name=twitter:image content="https://atharvapandey.com/"><meta property="og:type" content="article"><meta property="og:title" content="Traits: Advanced Trait Concepts and Dynamic Dispatch in Rust (Part 2) - Atharva Pandey"><meta property="og:description" content="Trait Objects and Dynamic Dispatch In Rust, polymorphism achieved through traits can take two forms: static and dynamic dispatch. Static dispatch is like knowing exactly what tool you’re going to use for a job, making it fast and efficient. Dynamic dispatch, on the other hand, is more flexible, allowing you to choose the right tool while the job is already underway.
Understanding Trait Objects and dyn Keyword Trait objects with the dyn keyword allow for this kind of runtime flexibility."><meta property="og:url" content="https://atharvapandey.com/post/rust/traits-part2-advance-trait-concepts/"><meta property="og:site_name" content="Atharva Pandey"><meta property="og:image" content="https://atharvapandey.com/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2024-02-28 18:30:00 +0000 UTC"><link rel=dns-prefetch href=https://www.googletagmanager.com><link href=https://www.googletagmanager.com rel=preconnect crossorigin></head><body><div style=position:relative><header class="flex-wrap px-3 Header js-details-container Details px-md-4 px-lg-5 flex-md-nowrap open Details--on"><div class="Header-item mobile-none" style=margin-top:-4px;margin-bottom:-4px><a class=Header-link href=https://atharvapandey.com/ aria-label=Homepage><img class=octicon height=32 width=32 alt=Logo src=/images/nerdy-crab-light.webp></a></div><div class="Header-item d-md-none"><button class="Header-link btn-link js-details-target" type=button aria-expanded=false aria-controls=header-search>
<img height=24 class="octicon octicon-three-bars" width=24 alt=Menu src=/images/nerdy-crab-light.webp></button></div><div style=display:none id=header-search class="mt-3 mr-0 Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-md-3 mt-md-0 Details-content--hidden-not-important d-md-flex"><div class="flex-auto mb-3 mr-0 Header-search header-search js-site-search position-relative flex-self-stretch flex-md-self-auto mb-md-0 mr-md-3 scoped-search site-scoped-search js-jump-to"><div class=position-relative><form target=_blank action=https://www.google.com/search accept-charset=UTF-8 method=get autocomplete=off role=search><label class="p-0 Header-search-label form-control input-sm header-search-wrapper js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center"><input type=search class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable" name=q placeholder=Search autocomplete=off aria-label=Search>
<input type=hidden name=as_sitesearch value=https://atharvapandey.com/></label></form></div></div></div><div class="Header-item Header-item--full flex-justify-center d-md-none position-relative"><a class=Header-link href=https://atharvapandey.com/ aria-label=Homepage><img class="octicon octicon-mark-github v-align-middle" height=32 width=32 alt=Logo src=/images/nerdy-crab-light.webp></a></div><div class=Header-item style=margin-right:0><button class="border-none Header-link no-select" onclick=switchTheme() aria-label="Switch Theme"><svg style="fill:var(--color-profile-color-modes-toggle-moon)" class="no-select" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.52208 7.71754c3.05612.0 5.53362-2.47748 5.53362-5.5336C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961 9.95801 1.07727 10.3495.771159 10.6474.99992c1.4679 1.12724 2.4141 2.90007 2.4141 4.89391.0 3.40575-2.7609 6.16667-6.16665 6.16667-2.94151.0-5.40199-2.0595-6.018122-4.81523C.794841 6.87902 1.23668 6.65289 1.55321 6.85451 2.41106 7.40095 3.4296 7.71754 4.52208 7.71754z"/></svg></button></div></header></div><div><main><div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4"><div class=px-0><div class="mb-3 d-flex px-3 px-md-3 px-lg-5"><div class="flex-auto min-width-0 width-fit mr-3"><div class=d-flex><div class="d-none d-md-block"><a class="avatar mr-2 flex-shrink-0" href=https://atharvapandey.com/><img class=avatar-user src=/images/avatar.webp width=32 height=32></a></div><div class="d-flex flex-column"><h1 class="break-word f3 text-normal mb-md-0 mb-1"><span class=author><a href=https://atharvapandey.com/>Atharva Pandey</a></span><span class=path-divider>/</span><strong class="css-truncate-target mr-1" style=max-width:410px><a href=https://atharvapandey.com/post/rust/traits-part2-advance-trait-concepts/>Traits: Advanced Trait Concepts and Dynamic Dispatch in Rust (Part 2)</a></strong></h1><div class="note m-0">Created <relative-time datetime="Wed, 28 Feb 2024 18:30:00 +0000" class=no-wrap>Wed, 28 Feb 2024 18:30:00 +0000</relative-time>
<span class=file-info-divider></span>
Modified <relative-time datetime="Wed, 28 Feb 2024 18:30:00 +0000" class=no-wrap>Wed, 28 Feb 2024 18:30:00 +0000</relative-time></div></div></div></div></div></div></div><div class="container-lg px-3 new-discussion-timeline"><div class="repository-content gist-content"><div><div class="js-gist-file-update-container js-task-list-container file-box"><div id=file-pytest class="file my-2"><div id=post-header class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style=z-index:2><div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0"><summary id=toc-toggle onclick=clickToc() class="btn btn-octicon m-0 mr-2 p-2"><svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered"><path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zM3 8A1 1 0 111 8a1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"/></svg></summary><details-menu class=SelectMenu id=toc-details style="display: none;"><div class="SelectMenu-modal rounded-3 mt-1" style=max-height:340px><div class="SelectMenu-list SelectMenu-list--borderless p-2" style=overscroll-behavior:contain id=toc-list></div></div></details-menu>849 Words</div><div class="file-actions flex-order-2 pt-0"><a class="muted-link mr-3" href=/tags/rust><svg class="octicon octicon-tag" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25.0 01.25-.25h5.025a.25.25.0 01.177.073l6.25 6.25a.25.25.0 010 .354l-5.025 5.025a.25.25.0 01-.354.0l-6.25-6.25A.25.25.0 012.5 7.775zm-1.5.0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464.0.91.184 1.238.513l6.25 6.25a1.75 1.75.0 010 2.474l-5.026 5.026a1.75 1.75.0 01-2.474.0l-6.25-6.25A1.75 1.75.0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"/></svg>
rust
</a><a class="muted-link mr-3" href=/tags/rust-tutorial><svg class="octicon octicon-tag" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25.0 01.25-.25h5.025a.25.25.0 01.177.073l6.25 6.25a.25.25.0 010 .354l-5.025 5.025a.25.25.0 01-.354.0l-6.25-6.25A.25.25.0 012.5 7.775zm-1.5.0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464.0.91.184 1.238.513l6.25 6.25a1.75 1.75.0 010 2.474l-5.026 5.026a1.75 1.75.0 01-2.474.0l-6.25-6.25A1.75 1.75.0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"/></svg>
rust tutorial</a></div></div></div><div class="Box-body px-5 pb-5" style=z-index:1><article class="markdown-body entry-content container-lg"><hr><h3 id=imagestraitswebp-trait-objects-and-dynamicdispatch><img src=/images/traits.webp alt> Trait Objects and Dynamic Dispatch</h3><p>In Rust, polymorphism achieved through traits can take two forms: static and dynamic dispatch. Static dispatch is like knowing exactly what tool you’re going to use for a job, making it fast and efficient. Dynamic dispatch, on the other hand, is more flexible, allowing you to choose the right tool while the job is already underway.</p><h3 id=understanding-trait-objects-and-dynkeyword>Understanding Trait Objects and dyn Keyword</h3><p>Trait objects with the dyn keyword allow for this kind of runtime flexibility. Imagine you&rsquo;re a chef with a set of kitchen tools (each representing a type). Each tool has a special function, like chopping, stirring, or scooping. In Rust, these functions are like traits, and the tools are the types that implement these traits.</p><p>Using dyn is like telling Rust: &ldquo;I&rsquo;m going to need a tool that can perform a certain function, but I&rsquo;ll decide which one to use as I go.&rdquo; This is incredibly useful when your Rust program needs the flexibility to work with different types at runtime, but it still ensures that each type can perform the function required by the trait.</p><h3 id=dynamic-dispatch-in-action-a-simplified-explanation>Dynamic Dispatch in Action: A Simplified Explanation</h3><p>When you decide on a tool to use (i.e., when a method is called on a trait object), Rust looks through a special list (the “vtable” virtual method table that maps trait methods to their concrete implementations.) to find out exactly how that tool performs the required function. This step is necessary because, with dyn, Rust doesn&rsquo;t know in advance which type (tool) you&rsquo;ll choose, only that it will be capable of the function (trait) you need.</p><p>This flexibility is like being able to surprise your dinner guests with an array of dishes, deciding how to prepare each one on the fly. However, it does require Rust to do a bit more work, looking up how each tool works every time you use it, which can make things a tad slower (this is the runtime overhead).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>trait</span> UseTool {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>use_tool</span>(<span style=color:#f92672>&amp;</span> self);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Knife</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Spoon</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Whisk</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> UseTool <span style=color:#66d9ef>for</span> Knife {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>use_tool</span>(<span style=color:#f92672>&amp;</span>self) {
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;Chopping with the knife!&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> UseTool <span style=color:#66d9ef>for</span> Spoon {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>use_tool</span>(<span style=color:#f92672>&amp;</span>self) {
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;Scooping with the spoon!&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> UseTool <span style=color:#66d9ef>for</span> Whisk {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>use_tool</span>(<span style=color:#f92672>&amp;</span>self) {
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;Whisking with the whisk!&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>use_kitchen_tool</span>(tool: <span style=color:#66d9ef>&amp;</span> <span style=color:#a6e22e>dyn</span> UseTool) {
</span></span><span style=display:flex><span>  tool.use_tool();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> knife <span style=color:#f92672>=</span> Knife;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> spoon <span style=color:#f92672>=</span> Spoon;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> whisk <span style=color:#f92672>=</span> Whisk;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Decide at runtime which tool to use
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  use_kitchen_tool(<span style=color:#f92672>&amp;</span> knife);
</span></span><span style=display:flex><span>  use_kitchen_tool(<span style=color:#f92672>&amp;</span> spoon);
</span></span><span style=display:flex><span>  use_kitchen_tool(<span style=color:#f92672>&amp;</span> whisk);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=why-dynamic-dispatch>Why Dynamic Dispatch?</h3><p>Dynamic dispatch with dyn and trait objects is about valuing flexibility and the ability to make decisions at runtime, especially when dealing with a variety of types that share common behavior. It&rsquo;s a trade-off, opting for the capability to handle diverse scenarios over the raw speed of knowing everything upfront with static dispatch.</p><h3 id=associated-types-intraits>Associated Types in Traits</h3><p>Moving on from dynamic dispatch, let’s explore associated types, another advanced feature that enhances the expressiveness and utility of Rust traits.</p><h3 id=defining-and-using-associated-types>Defining and Using Associated Types</h3><p>Associated types allow a trait to specify a placeholder type that implementing types must define. This is particularly useful when a trait’s methods need to return or accept values of a type that should be specified by the implementor.</p><p>Consider a simple Graph trait with an associated type Node:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>trait</span> Graph {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Node</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>add_node</span>(<span style=color:#f92672>&amp;</span> <span style=color:#66d9ef>mut</span> self, node: <span style=color:#a6e22e>Self</span>:: <span style=color:#a6e22e>Node</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>has_node</span>(<span style=color:#f92672>&amp;</span> self, node: <span style=color:#66d9ef>&amp;</span> <span style=color:#a6e22e>Self</span>:: <span style=color:#a6e22e>Node</span>) -&gt; <span style=color:#66d9ef>bool</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here, Node is an associated type that each implementation of Graph must specify, allowing for a flexible yet type-safe graph interface.</p><h3 id=enhancing-generic-implementations-with-associated-types>Enhancing Generic Implementations with Associated Types</h3><p>Associated types help in writing more generic and reusable code. By defining a trait with associated types, we can create implementations that are tailored to specific use cases while adhering to a consistent interface defined by the trait</p><h3 id=special-traits-inrust>Special Traits in Rust</h3><p>Rust has several special traits that have a significant impact on how types behave. Traits like Clone, Copy, PartialEq, and others can provide essential capabilities or enforce certain constraints on types.</p><h3 id=exploring-clone-copy-partialeq-andmore>Exploring Clone, Copy, PartialEq, and More</h3><ul><li>Clone and Copy: These traits control how objects are duplicated. Copy is for simple bitwise duplication, while Clone can involve more complex logic for deep copying.</li><li>PartialEq and Eq: These traits enable comparison operations. PartialEq allows for partial equality checks, while Eq implies a stricter, full equivalence between values.</li></ul><p>Understanding and implementing these special traits can greatly enhance the functionality and usability of your custom types in Rust.</p><h3 id=wrapping-up>Wrapping Up</h3><p>Today, we’ve ventured further into Rust’s trait system, uncovering the depths of dynamic dispatch, the versatility of associated types, and the utility of special traits. These advanced features unlock new levels of expressiveness and power in Rust programming, allowing us to write more flexible, reusable, and safe code.</p><p>In our next and final installment, we’ll tackle some of the edge cases and best practices around Rust traits, ensuring you’re well-equipped to harness their full potential in your Rust projects. Until then, happy coding, and may your exploration of Rust traits be as enlightening as it is enjoyable!</p></article></div></div></div></div></div></div></main></div><script type=application/javascript src=https://atharvapandey.com/js/toc.js></script><link rel=stylesheet href=https://atharvapandey.com/css/toc.css><div class="px-3 container-lg new-discussion-timeline"><script defer src=https://giscus.app/client.js data-repo=gopherine/hugo-blog data-repo-id=R_kgDOLTrS1w data-category=Announcements data-category-id data-mapping=title data-strict=0 data-reactions-enabled data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div><applause-button style="width: 58px; height: 58px; position: fixed; bottom: 20px; left: 20px;"><div class="footer container-xl width-full p-responsive"><div class="flex-row-reverse flex-wrap pt-6 pb-2 mt-6 position-relative d-flex flex-lg-row flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center f6 text-gray border-top border-gray-light"><a aria-label=Homepage title=GitHub class="footer-octicon d-none d-lg-block mr-lg-4" href=https://atharvapandey.com/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="flex-wrap mb-2 list-style-none d-flex col-12 flex-justify-center flex-lg-justify-between mb-lg-0"><li class="mr-3 mr-lg-0">Copyright © 2024 Atharva Pandey</li></ul></div><div class="pb-6 d-flex flex-justify-center"><span class="f6 text-gray-light"></span></div></div></body><script defer type=application/javascript src=https://atharvapandey.com/js/github-style.js></script></html>